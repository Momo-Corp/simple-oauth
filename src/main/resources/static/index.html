<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ma Ferme 🐄</title>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="p-4" x-data="farmApp()">

  <h1 class="text-xl font-bold mb-4">Bienvenue à la Ferme 🐮</h1>

  <button @click="login" class="mb-2 px-4 py-2 bg-blue-500 text-white rounded">🔐 Se connecter</button>
  <p x-text="token ? 'Token récupéré ✔️' : ''" class="mb-4 text-green-600 font-mono"></p>

  <div x-show="token" class="space-x-2">
    <button @click="getCow" class="px-3 py-1 bg-gray-200 rounded">🐄 Voir la vache</button>
    <button @click="feedCow" class="px-3 py-1 bg-green-200 rounded">🍽️ Nourrir</button>
    <button @click="hungryCow" class="px-3 py-1 bg-red-200 rounded">😩 Affamer</button>
  </div>

  <pre class="mt-4 bg-gray-100 p-2 rounded" x-text="JSON.stringify(response, null, 2)"></pre>

  <script>
    function farmApp() {
      return {
        token: null,
        response: null,

        async login() {
          try {
            const res = await fetch('http://localhost:8080/auth/test-token');
            this.token = await res.text();
          } catch (err) {
            console.error('Erreur lors du login:', err);
          }
        },

        async callApi(method, url) {
          try {
            const res = await fetch(`http://localhost:8080${url}`, {
              method,
              headers: {
                'Authorization': `Bearer ${this.token}`
              }
            });
            this.response = await res.json();
          } catch (err) {
            this.response = { error: 'Erreur API', details: err.message };
          }
        },

        getCow() {
          this.callApi('GET', '/farm/cow');
        },

        feedCow() {
          this.callApi('POST', '/farm/cow/feed');
        },

        hungryCow() {
          this.callApi('POST', '/farm/cow/hungry');
        }
      };
    }
  </script>
</body>
</html>
